# 公有IP(Public IP) And 私有IP(Private IP)

通常在一個家庭或公司內網中，**只有一個對外IP地址**，這個IP地址是由ISP（網路服務提供商）分配的**公有IP**，用於在網際網路上識別這個網路的「出口」。

而內網中的設備由 DHCP 伺服器分配的IP，屬於**私有IP**，這些IP地址無法直接被外部網路訪問。

## 1. 公有IP vs. 私有IP

- **公有IP (Public IP)**：

  這是 ISP 分配給你的路由器的IP地址，用於在網際網路上唯一識別你的網路。

  所有出入網際網路的數據流都會經過這個IP地址。

  它是對外公開的，例如你的家庭網路通常會有一個公有IP地址。

- **私有IP (Private IP)**：

  這是內網(如家庭或公司內部網路)中的設備所使用的IP地址範圍。

  私有IP 無法直接在網際網路上使用(也是一種網路安全的防護)，
  僅適用於內網(那內網如何和網際網路溝通，跟路由器、路由表、NAT 等有關，後續會提到)，
  並且由 DHCP 伺服器自動分配給各個設備。

  常見的私有IP 範圍包括：

  - `192.168.x.x`

  - `10.x.x.x`

  - `172.16.x.x` 到 `172.31.x.x`

## 2. NAT(網路位址轉換) — 公有IP與私有IP的橋樑

內網中的設備需要通過「網路位址轉換」（NAT）機制來使用公有IP 與外部網路通訊。

NAT 通常由路由器處理，並負責將**私有IP轉換為公有IP**，具體過程如下：

1. **內網設備使用私有IP進行通訊**:

   內網中的設備，如: 電腦或手機，會使用由 DHCP 分配的私有IP 來進行本地通訊。

2. **NAT轉換過程**:

   當內網設備需要訪問網際網路時，數據包會經過路由器的 NAT 轉換。

   NAT 會將內網的私有IP轉換成路由器的公有IP，並且記錄這些轉換資訊(包含端口號等)。

   > [!NOTE]
   >
   > 一種 mapping 的過程，將內網的私有IP地址映射到路由器的公有IP地址。
   > 並記錄是從哪個內網ip、ports 等資訊，這樣當外部網路回應時，才能將封包送回正確的內網設備。

3. **返回的數據包轉回內網**:

   當返回的數據包抵達路由器時，
   NAT 會將公有IP轉換回原始的私有IP地址，並將數據包發送給內網的正確設備。

這樣一來，所有內網設備都能共享路由器的公有IP，並通過NAT進行網際網路通訊。

外部世界只看到路由器的公有IP，而看不到內網的私有IP地址。

### 總結

- **只有一個對外的公有IP**:

  家庭或公司網路通常只有一個公有IP，由 ISP 分配，用於網際網路通訊。

- **DHCP 分配的私有IP**:

  DHCP 分配的私有IP 僅在內網中有效，但它們不會直接在網際網路上使用。

  see [DHCP](./dhcp.md)

- **NAT轉換機制**:

  路由器使用 NAT 機制將內網的私有IP轉換為公有IP，實現內網與外網的通訊。

透過 NAT 和 DHCP，內網中的設備可以共享一個對外的公有IP，並同時享有內網的私有IP 以進行本地通訊。
