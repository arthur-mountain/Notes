# 數據鏈路層的封包(Frame Data Packet)

在開始之前，請確保您已閱讀以下內容:

1. [data packet format overview](./data-packet-format-overview.md)

## Summary

數據鏈路層使用的封包稱為 **幀(Frame)**，通常使用 **以太網協議**。

## Overview

- 在 OSI 模型中，只有 **數據鏈路層(Data Link Layer)** 的封裝單位 **frame(幀)** 會添加尾部(Trailer)。

  這是因為數據鏈路層需要在本地網路上保證數據的完整性，而這一層的尾部通常用於 **錯誤檢查**。

  其他層一般不會添加尾部，而是只添加頭部(header)並包含物理位址和錯誤檢查信息。

- **以太網幀格式**:

  - **目的 MAC 地址**: 數據包的接收方硬體地址。

  - **源 MAC 地址**: 數據包的發送方硬體地址。

  - **以太類型**: 表示上層協議(如 IPv4 或 IPv6)。

  - **數據**: 承載的上層協議數據(如 IP 包)。

  - **FCS(幀檢查序列)**: 用於錯誤檢查。

## 數據鏈路層(Data Link Layer)尾部的作用

數據鏈路層的尾部通常包含一個 **FCS(Frame Check Sequence，幀檢查序列)**，用來檢測數據在傳輸過程中是否出現錯誤:

- **FCS(幀檢查序列)**:

  通常是使用 **CRC(循環冗餘校驗)** 算法計算出的校驗碼，將其放置在數據鏈路層的尾部。

  當數據幀到達接收方後，接收方可以對數據幀重新計算 CRC 值，
  並與尾部的 FCS 值進行比較，以檢查數據是否在傳輸過程中發生錯誤。

- **尾部的長度**:

  根據協議和網路技術的不同，尾部長度會有所不同，但通常是固定的。

  例如，以太網的尾部通常是 4 個位元組，用來存放 FCS。

### 其他層為什麼沒有尾部？

其他層(如網路層、傳輸層)通常不會添加尾部，原因如下:

1. **錯誤檢查在數據鏈路層已經處理**:

   數據鏈路層的 FCS 已經提供了檢測數據完整性的機制。

   其他層的錯誤檢查(如 TCP 的校驗和)是在頭部內完成的，不需要額外的尾部來進行錯誤檢查。

2. **多層錯誤控制的冗餘**:

   傳輸層(例如 TCP)和網路層(如 IP)也有各自的錯誤檢查機制，
   但它們將錯誤檢查信息放在頭部字段中。

   例如 TCP header 中的 **校驗和(Checksum)**。

   這樣可以避免每一層都添加尾部，減少了封包的開銷和複雜度。

3. **效率和簡化**:

   在高層協議中，數據可能會頻繁地被切分和重組，如果每一層都添加尾部會增加處理複雜度。

   因此，在高層協議中通過頭部字段來記錄必要的信息，而不是添加尾部。

### 總結

- **尾部(Trailer)** 是數據鏈路層專有的，通常包含 FCS，用於錯誤檢查。

- **其他層不需要尾部**，因為錯誤檢查等信息通常放在頭部，避免每一層都添加尾部的冗餘和複雜性。

- **錯誤檢查機制的分工**: 數據鏈路層的 FCS 保證在同一網段內的數據完整性，而傳輸層的校驗和則確保端到端的完整性。
