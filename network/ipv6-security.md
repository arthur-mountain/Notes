# IPv6的安全性問題

Before we start, please make sure you have read the

1. [IPv4 and IPv6](./ipv4-and-ipv6.md)

因為 IPv6 提供了足夠多得 IP 位址，使得每台裝置都可以直接連上網際網路，

但也因直接連接能力，同時也帶來了安全上的新挑戰。

為了應對這些挑戰，IPv6引入了不同的安全機制，並且在特定情況下仍然可以使用類似NAT的技術。

## 1. IPv6的端到端連接是否會增加安全風險？

是的，IPv6的設計目標之一是實現端到端的連接，每台設備可以直接擁有公有IP並與網際網路通信。

這也帶來了安全風險，因為每個設備都可能直接暴露在網路上。

但IPv6同時引入了新的安全機制：

- **防火牆**:

  大多數IPv6網路部署了防火牆，默認會攔截不必要的入站請求，只允許特定的端口或連線請求。

  IPv6路由器一般內建了防火牆，並且大多數系統默認啟用防火牆。

- [**IPsec(網路層安全協議)**](./ipsec.md):

  IPv6內建了IPsec支持，它是針對網路層的加密與認證協定，可以實現安全通信。

  雖然IPsec在IPv4中也可以使用，但在IPv6中更加普遍，因為它是IPv6標準的一部分。

## 2. IPv6的NAT66與IPv4的NAT有什麼不同？

IPv6設計上避免了NAT的使用，但在某些情況下，NAT66可以用於**特殊場景的網路隔離**。

NAT66與IPv4的NAT之間的主要區別是：

- **NAT66的用途有限**:

  NAT66主要用於內部網路的地址轉換，但不進行IPv4中的私有IP到公有IP的轉換，而是進行IPv6地址的「翻譯」。

  例如，公司內部可能會使用NAT66來隱藏內部網路結構。

- **NAT66不解決IPv6地址數量問題**:

  IPv4中的NAT是為了解決公有IP地址不足問題，

  而NAT66則不是為了節省IP地址，僅僅是用於特定的網路架構需求。

## 3. IPv6的SLAAC是什麼？

SLAAC(Stateless Address Autoconfiguration，無狀態地址自動配置)

是IPv6的一種自動地址配置機制，使得設備在加入網路時可以自動生成一個全球唯一的IPv6地址。

### 特點和作用

- **無需中央伺服器**:

  SLAAC依賴路由器提供的前綴來自動生成地址，不需要像DHCP伺服器那樣的集中管理。

- **確保全球唯一**:

  通過使用設備的MAC地址或隨機生成識別符的方式，SLAAC生成的IPv6地址在全球範圍內是唯一的。

- **自動配置**:

  SLAAC設計目標是讓設備在連接到網路後自動生成可用的IPv6地址，實現即插即用的效果，特別適合家庭網路或小型網路環境。

### SLAAC的工作流程如下

1. **路由器公告(Router Advertisement)**:

   - 當IPv6設備(如電腦、手機)加入網路時，
     它會發送一個「路由請求」(Router Solicitation, RS)訊息，
     詢問網路中的路由器可用的IP地址範圍。

   - IPv6路由器定期發送RA(Router Advertisement，路由公告)訊息，
     包含該網路的IPv6前綴(Prefix)等資訊，
     告訴內網設備，可以使用這個(我們的) IPv6 前綴，
     此前綴也決定了該網路的IPv6地址範圍，例如`2001:db8::/64`。

2. **設備自動生成IPv6地址**：

   - 設備接收到路由器的RA訊息後，會根據網路前綴自行生成一個IPv6地址。
     這個地址由兩部分組成:

     - **網路前綴**:

       由路由器公告提供，通常是前64位。

     - **設備識別符**:

       通常是後64位，可以通過設備的MAC地址生成(例如EUI-64格式)，或者隨機生成，以達到全球唯一的目的。

   來形成一個完整的IPv6地址。

3. **地址唯一性檢查(DAD, Duplicate Address Detection)**：

   - 設備生成地址後，會進行「重複地址檢測」(DAD)，以確認該地址在網路中不重複。

     - 設備會向內網其他設備廣播自己的地址並檢查是否有其他設備回應，以確認這個地址在網路中是唯一的。

   - 如果地址不重複，設備就可以使用這個地址進行通信。

4. **無需DHCP服務器**:

   SLAAC不需要DHCP伺服器即可生成IPv6地址，非常適合家庭或企業內部網路的簡單部署。

## 4. DHCPv6與傳統的DHCP有什麼區別？

IPv6支持兩種地址配置方式： **SLAAC**和**DHCPv6**。

雖然SLAAC可以實現自動配置，但在企業網路中可能需要更細緻的控制，因此也有**DHCPv6**，用於提供額外的配置。

以下是DHCPv6與傳統DHCP(IPv4的DHCP)的主要區別：

- **支持的協定**:

  傳統DHCP僅支援IPv4地址配置，而DHCPv6則是專為IPv6設計的。

- **配置方式的彈性**:

  在IPv6中，可以同時使用SLAAC和DHCPv6。

  SLAAC主要用於地址自動配置，

  而DHCPv6可以提供額外的配置資訊，如DNS伺服器和域名。

- **DHCPv6的無狀態模式**:

  DHCPv6支持「無狀態模式」(Stateless)，僅分配配置資訊(例如DNS)，而不分配IP地址。

  這樣，設備可以使用SLAAC生成IP地址，並通過DHCPv6獲取其他配置資訊。

## 總結

1. **IPv6的端到端連接**:

   IPv6實現了端到端連接，確實帶來了一些安全風險，但可以通過防火牆和IPsec等安全機制加以控制。

2. **NAT66用途有限**:

   IPv6不需要NAT來節省IP地址，NAT66僅用於少數場景中的網路隔離。

3. **SLAAC的自動配置**:

   SLAAC允許設備自動生成IPv6地址，而無需DHCP伺服器。

4. **DHCPv6的功能更強大**:

   DHCPv6支援無狀態配置模式，可以與SLAAC配合使用，提供靈活的配置選項。

IPv6的設計旨在簡化配置並強化安全，使得每台設備都可以直接通過公有IP進行連接，但仍然有各種安全機制來防範潛在的風險。
