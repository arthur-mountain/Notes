# 文件描述符(descriptor)

文件描述符在 Linux 中確實是用一個正整數來表示，但它**並不作為文件的名稱**，也不是一個符號鏈接(symbolic link)。

- **文件描述符的本質**:

  是進程中的`一個數據結構，通常存儲在**內存中**，
並指向文件的內核數據結構的「指針」`。

  這個數據結構用來追蹤和管理打開的文件。

  每當打開一個文件時，內核會為該文件創建一個文件描述符，該描述符與文件的實際位置(inode)建立關聯。

- **文件描述符的作用**:

  文件描述符的數字僅用於在進程中標識這個文件，進程通過這個數字來訪問和操作文件(如讀取、寫入)。

  這個數字不會直接代表文件的名稱，甚至在多個進程中可以指向不同的文件。

例如：

- 在進程中，文件描述符 `3` 可能指向 `/var/log/syslog`，而在另一個進程中，文件描述符 `3` 可能指向 `/etc/hosts`。

這些描述符都是獨立的，不涉及文件名或符號鏈接。

## 文件描述符的存儲位置

- **內存中的文件描述符表**:

  每個進程在內存中都維護著一個「文件描述符表」(File Descriptor Table)，這是一張存儲文件描述符的內部表格。

  每當進程打開文件時，系統會在這張表中添加一個新條目，並分配一個整數來作為該文件的文件描述符。

- 文件描述符表中的條目會**指向內核空間中的一個文件表項**，該表項包含文件的詳細信息，包括文件的位址(inode)、打開模式、當前的讀寫指針位置等。

## 文件描述符是如何指向文件的

- **內核中的文件表(File Table)**:

  文件描述符表中的每個條目指向內核空間的一個「文件表」中的結構。

  這個結構可以理解為一個「指針」，指向文件的實際資訊。

  該文件表結構包含指向文件 inode 的指標，
  並保存了當前文件狀態(如讀寫模式、偏移量等)。

- **inode 結構**:

  文件的 inode(index node)
  包含文件的實際位址和數據的管理信息(例如磁碟位置)。

  這樣，文件描述符經由文件表再指向 inode，
  最終指向文件在磁碟中的位址。

## 文件描述符的工作流程

當一個進程要讀取或寫入文件時，它會根據文件描述符表找到相應的文件描述符條目，通過該條目訪問內核文件表，然後內核根據文件表中的 inode 資訊找到文件的實際內容和位址，從而進行讀寫操作。

## 數據的寫入方式

數據寫入文件時，通常以**二進制格式**進行，
即所有數據本質上都是以二進制形式存儲的，
但存儲的數據可能是文本(字符)或者其他格式。

- **二進制寫入的本質**:

  計算機底層操作數據的單位是位元(bit)，所以無論是文本、數字還是圖片等數據，最後都是以二進制形式寫入到文件中。

- **文本與二進制的區別**:

  - 對於文本文件，二進制數據以 ASCII 或 UTF-8 等編碼格式進行解讀，並顯示為人類可讀的字符。

  - 對於二進制文件，數據可能包含純數字、圖片像素、壓縮數據等，不依賴於字符編碼，直接以位元組序列進行處理。

## 總結

- **文件描述符**本質上是一個整數，
  作為進程內的一個「變數」，指向內核中的文件表條目。

- 文件描述符在**內存中**儲存，
  並通過內核數據結構來間接指向文件的內容。

- 當進程使用文件描述符進行讀寫時，
  內核會根據這一描述符找到文件表條目，
  進而訪問文件的 inode 結構，以找到文件在磁碟中的具體位置和內容。

- **數據以二進制方式寫入文件**，
  即使是文本文件，底層存儲的也是二進制數據，不同的數據格式只是通過不同的編碼方式來解讀這些位元組。
